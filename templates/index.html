<!DOCTYPE html>
<html lang="en">

<head>

    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traker - Create and Track Your Links</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Background styling to match the design */
            background-color: #0B0E1E;
            background-image: url('../static/images/dark-gradient-background-with-copy-space_53876-99548.avif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* Custom class for the glassmorphism effect */
        .glass-card {
            background-color: rgba(30, 35, 70, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #4A5568;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        /* Style for input fields */
        .form-input {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-input::placeholder {
            color: #9CA3AF;
        }

        .form-input:focus {
            outline: none;
            border-color: #60A5FA;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5);
        }
    </style>
</head>

<body class="text-gray-200">

    <div class="container mx-auto px-4 py-6">

        <!-- Header -->
        <header class="glass-card rounded-xl p-4 flex justify-between items-center mb-12">
            <a href="{% url 'users:index' %}" class="text-2xl font-bold tracking-wider text-white">Traker</a>

            <a href="{% url 'users:login' %}"> <button
                    class="bg-blue-500/50 hover:bg-blue-500/80 text-white font-semibold py-2 px-5 rounded-lg transition-colors">
                    Logout
                </button></a>
        </header>

        <div id="popupMessage" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl p-6 w-96 text-center">
                <h2 class="text-xl text-red-400 font-semibold mb-2">NOTE!</h2>
                <p class="text-gray-700 mb-4">This web application is built for educational purposes to track how many
                    times important links such as your portfolio, GitHub, LinkedIn and CV are opened. It helps you
                    understand user engagement when sharing your resume or online profiles. You can also track any other
                    custom links. Please note that if your portfolio is hosted on GitHub Pages, tracking may not work
                    properly due to static hosting limitations. Hosting your portfolio on a dynamic platform like Render
                    will resolve this issue. This site itself is hosted on  Railway , and while it serves the purpose, it
                    may have some limitations as it's intended purely for learning and demonstration.

                </p>
                <button onclick="closePopup()"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition">
                    Close
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main>
            <!-- Hero Section -->
            <section class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-4">Create, Share, and Analyze</h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    Transform long URLs into powerful, trackable links. Gain insights into every click and understand
                    your audience better.
                </p>
            </section>

            <!-- Link Creation Form -->
            <section class="glass-card rounded-2xl p-6 md:p-8 mb-8">
                <form id="link-form" method="POST">
                    {% csrf_token %}
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        <div class="md:col-span-2">
                            <label for="original-link" class="block mb-2 text-sm font-medium text-gray-300">Paste your
                                long link here</label>
                            <input type="url" id="original-link" name="url" class="form-input w-full p-3 rounded-lg"
                                placeholder="https://example.com/very-long-link-to-shorten" required>
                        </div>

                        <div>
                            <label for="category" class="block mb-2 text-sm font-medium text-gray-300">Category</label>
                            <select id="category" name="category" class="form-input w-full p-3 rounded-lg ">
                                <option value="portfolio">Portfolio</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="github">GitHub</option>
                                <option value="youtube">YouTube</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <!-- <div class="md:col-span-3">
                            <label for="custom-slug" class="block mb-2 text-sm font-medium text-gray-300">Custom Link
                                Name (Optional)</label>
                            <input type="text" id="custom-slug" name="custom_slug"
                                class="form-input w-full p-3 rounded-lg" placeholder="e.g., mycoollink">
                        </div> -->

                        <div id="other-category-wrapper" class="hidden md:col-span-3">
                            <label for="other-category-input"
                                class="block mb-2 text-sm font-medium text-gray-300">Please specify the category</label>
                            <input type="text" id="other-category-input" name="other_category"
                                class="form-input w-full p-3 rounded-lg" placeholder="e.g., Blog Post, Social Media">
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <button type="submit"
                            class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-10 rounded-lg transition-colors text-lg">
                            Create Link
                        </button>
                    </div>
                </form>
            </section>

            <!-- New Link Display Section (hidden by default) -->
            <section id="new-link-section" class="hidden glass-card rounded-2xl p-6 md:p-8 mb-8 text-center">
                <h2 class="text-2xl font-bold mb-4">Your New Link is Ready!</h2>
                <div class="flex justify-center items-center gap-4 bg-black/20 p-4 rounded-lg">
                    <span id="new-link-display" class="text-lg text-green-400 font-mono"></span>
                    <button id="copy-button"
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span id="copy-button-text">Copy</span>
                    </button>
                </div>
            </section>

            <!-- Link Overview Table -->
            <section id="overview-section" class="glass-card rounded-2xl p-6 md:p-8">
                <h2 class="text-2xl font-bold mb-6">Link Overview</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-600 ">
                                <th class="p-3">Original Link</th>
                               
                                <th class="p-3">Category</th>
                                <th class="p-3 text-right">Clicks</th>
                                <th class="p-3 text-right">Actions</th>

                            </tr>
                        </thead>
                        <tbody id="links-table-body">
                            {% for link in links %}
                            <tr class="border-b border-gray-700/50">
                                <td class="p-3">{{ link.url }}</td>
                               

                                <!-- âœ… Correct Category Display -->
                                <td class="p-3">
                                    {% if link.category == "other" %}
                                    {{ link.other_category_name }}
                                    {% else %}
                                    {{ link.category|title }}
                                    {% endif %}
                                </td>

                                <td class="p-3 text-right">{{ link.click_count }}</td>

                                <td class="p-3 text-right">
                                    <a href="{% url 'users:track_click' link.id %}" target="_blank"
                                        class="text-green-400 hover:text-green-700">Visit</a>

                                    <form action="{% url 'users:delete_link' link.id %}" method="POST"
                                        onsubmit="return confirm('Are you sure you want to delete this link?');">
                                        {% csrf_token %}
                                        <button type="submit"
                                            class="text-red-400 hover:text-red-700 py-1 rounded-lg text-sm">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>

                            {% empty %}
                            <tr>
                                <td colspan="5" class="p-3 text-center text-gray-400">No links yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>
                </div>
            </section>
        </main>

    </div>
    <script>
        function closePopup() {
            document.getElementById("popupMessage").style.display = "none";
        }

        // Optional: Auto-show popup only once (session-based)
        window.onload = function () {
            document.getElementById("popupMessage").style.display = "flex";
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const categorySelect = document.getElementById("category");
            const otherCategoryWrapper = document.getElementById("other-category-wrapper");
            const linkForm = document.getElementById("link-form");
            const newLinkSection = document.getElementById("new-link-section");
            const newLinkDisplay = document.getElementById("new-link-display");
            const copyButton = document.getElementById("copy-button");
            const copyButtonText = document.getElementById("copy-button-text");

            categorySelect.addEventListener("change", function () {
                if (this.value === "other") {
                    otherCategoryWrapper.classList.remove("hidden");
                } else {
                    otherCategoryWrapper.classList.add("hidden");
                }
            });

            linkForm.addEventListener("submit", function (e) {
                e.preventDefault();
                const formData = new FormData(linkForm);

                fetch("", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                    },
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        newLinkSection.classList.remove("hidden");
                        newLinkDisplay.textContent = data.tracking_url;
                    });
            });

            copyButton.addEventListener("click", function () {
                navigator.clipboard.writeText(newLinkDisplay.textContent).then(() => {
                    copyButtonText.textContent = "Copied!";
                    setTimeout(() => copyButtonText.textContent = "Copy", 6000);
                });
            });
        });
    </script>






</body>

</html>